function cdivA(a,b,c,d,e,f,g,h){var i,j,k,l,m;i=Math.abs(c)+Math.abs(d),j=a/i,k=b/i,l=c/i,m=d/i,i=l*l+m*m,e[f][g]=(j*l+k*m)/i,e[f][h]=(-(j*m)+k*l)/i}function computeQR(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o,p,q,s,t,u,v,w,x,y,z,A,B,C=0,D=0,E=0,F=d,G=1,H=30*a,I=0;a>I;I++){for(var J=E;a>J;J++)C+=Math.abs(b[I][J]);E=I,(c>I||I>d)&&(e[I]=0,f[I]=b[I][I])}for(;F>=c;){G?(y=0,A=F-1,z=A-1):G=1;for(var I=c;F>=I&&(v=F+c-I,v!=c)&&(k=Math.abs(b[v-1][v-1])+Math.abs(b[v][v]),0==k&&(k=C),m=k,n=m+Math.abs(b[v][v-1]),n!=m);I++);if(s=b[F][F],v!=F)if(t=b[A][A],q=b[F][A]*b[A][F],v!=A){if(0==H)return void(g.outEr=F+1);if(10==y||20==y){D+=s;for(var I=c;F>=I;I++)b[I][I]+=-s;k=Math.abs(b[F][A])+Math.abs(b[A][z]),t=s=.75*k,q=-.4375*k*k}for(y++,H--,w=z;w>=v&&(u=b[w][w],r=-u+s,k=-u+t,h=(-q+r*k)/b[w+1][w]+b[w][w+1],i=-(u+r+k)+b[w+1][w+1],r=b[w+2][w+1],k=Math.abs(h)+Math.abs(i)+Math.abs(r),h/=k,i/=k,r/=k,w!=v)&&(m=Math.abs(h)*(Math.abs(b[w-1][w-1])+Math.abs(u)+Math.abs(b[w+1][w+1])),n=m+Math.abs(b[w][w-1])*(Math.abs(i)+Math.abs(r)),m!=n);w--);x=w+2;for(var I=x;F>=I;I++)b[I][I-2]=0,I!=x&&(b[I][I-3]=0);for(var I=w;A>=I;I++){if(B=I!=A?1:0,I!=w){if(h=b[I][I-1],i=b[I+1][I-1],r=B?b[I+2][I-1]:0,s=Math.abs(h)+Math.abs(i)+Math.abs(r),0==s)continue;h/=s,i/=s,r/=s}if(k=Math.sqrt(h*h+i*i+r*r),0>h&&(k=-k),I!=w?b[I][I-1]=-(k*s):v!=w&&(b[I][I-1]=-b[I][I-1]),h+=k,s=h/k,t=i/k,u=r/k,i/=h,r/=h,E=F>I+3?I+3:F,B){for(var J=I;a>J;J++)h=b[I][J]+i*b[I+1][J]+r*b[I+2][J],b[I][J]+=-(h*s),b[I+1][J]+=-(h*t),b[I+2][J]+=-(h*u);for(var J=0;E>=J;J++)h=s*b[J][I]+t*b[J][I+1]+u*b[J][I+2],b[J][I]+=-h,b[J][I+1]+=-(h*i),b[J][I+2]+=-(h*r)}else{for(var J=I;a>J;J++)h=b[I][J]+i*b[I+1][J],b[I][J]+=-(h*s),b[I+1][J]+=-(h*t);for(var J=0;E>=J;J++)h=s*b[J][I]+t*b[J][I+1],b[J][I]+=-h,b[J][I+1]+=-(h*i)}}G=0}else{if(h=(-s+t)/2,i=h*h+q,u=Math.sqrt(Math.abs(i)),s=b[F][F]=s+D,b[A][A]=t+D,i>=0){u=0>h?-u+h:h+u,f[F]=f[A]=s+u,0!=u&&(f[F]=-(q/u)+s),e[F]=e[A]=0,s=b[F][A],k=Math.abs(s)+Math.abs(u),h=s/k,i=u/k,r=Math.sqrt(h*h+i*i),h/=r,i/=r;for(var J=A;a>J;J++)u=b[A][J],b[A][J]=i*u+h*b[F][J],b[F][J]=-(h*u)+i*b[F][J];for(var J=0;F>=J;J++)u=b[J][A],b[J][A]=i*u+h*b[J][F],b[J][F]=-(h*u)+i*b[J][F]}else f[F]=f[A]=s+h,e[A]=u,e[F]=-u;F--,F--}else f[F]=b[F][F]=s+D,e[F]=0,F--}if(0!=C)for(F=a-1;F>=0;F--)if(h=f[F],i=e[F],A=F-1,!(i>0))if(0==i){w=F,b[F][F]=1;for(var J=A;J>=0;J--){q=-h+b[J][J],r=0;for(var K=w;F>=K;K++)r+=b[J][K]*b[K][F];if(e[J]<0)u=q,k=r;else{if(w=J,0==e[J]){if(D=q,0==D){D=m=C;do D*=.01,n=C+D;while(n>m)}b[J][F]=-(r/D)}else s=b[J][J+1],t=b[J+1][J],i=(-h+f[J])*(-h+f[J])+e[J]*e[J],b[J][F]=D=(-(u*r)+s*k)/i,b[J+1][F]=Math.abs(s)>Math.abs(u)?-(r+q*D)/s:-(k+t*D)/u;if(D=Math.abs(b[J][F]),0==D)continue;if(m=D,n=m+1/m,n>m)continue;for(var K=J;F>=K;K++)b[K][F]/=D}}}else{w=A,Math.abs(b[F][A])<=Math.abs(b[A][F])?cdivA(0,-b[A][F],-h+b[A][A],i,b,A,A,F):(b[A][A]=i/b[F][A],b[A][F]=-(-h+b[F][F])/b[F][A]),b[F][A]=0,b[F][F]=1;for(var J=A-1;J>=0;J--){q=-h+b[J][J],l=j=0;for(var K=w;F>=K;K++)j+=b[J][K]*b[K][A],l+=b[J][K]*b[K][F];if(e[J]<0)u=q,r=j,k=l;else{if(w=J,0==e[J])cdivA(-j,-l,q,i,b,J,A,F);else{if(s=b[J][J+1],t=b[J+1][J],p=-(i*i)+(-h+f[J])*(-h+f[J])+e[J]*e[J],o=2*(-h+f[J])*i,0==p&&0==o){m=C*(Math.abs(q)+Math.abs(i)+Math.abs(s)+Math.abs(t)+Math.abs(u)),p=m;do p*=.01,n=m+p;while(n>m)}cdivA(-(u*j)+s*r+i*l,-(u*l+i*j)+s*k,p,o,b,J,A,F),Math.abs(s)>Math.abs(u)+Math.abs(i)?(b[J+1][A]=(-(j+q*b[J][A])+i*b[J][F])/s,b[J+1][F]=-(l+q*b[J][F]+i*b[J][A])/s):cdivA(-(r+t*b[J][A]),-(k+t*b[J][F]),u,i,b,J+1,A,F)}if(D=Math.abs(Math.abs(b[J][A])>=Math.abs(b[J][F])?b[J][A]:b[J][F]),0!=D&&(m=D,n=m+1/m,!(n>m)))for(var K=J;F>=K;K++)b[K][A]/=D,b[K][F]/=D}}}}function computeEigenSystem(a,b,c,d,e){var f,g,h,i,j,k,l,m,n=new Array(a),o=new Array(a),p=2,q=p*p,r=-1,s=0,t=a-1;for(m=t;m>=0;){i=0;for(var u=0;t>=u;u++)if(u!=m&&0!=b[m][u]){i=1;break}if(0==i){if(n[t]=m,m!=t){for(var v=0;t>=v;v++)g=b[v][m],b[v][m]=b[v][t],b[v][t]=g;for(var v=0;a>v;v++)g=b[m][v],b[m][v]=b[t][v],b[t][v]=g}if(0==t)break;m=--t}else m--}if(t>0){for(m=0;t>=m;){f=0;for(var v=s;t>=v;v++)if(v!=m&&0!=b[v][m]){f=1;break}if(0==f){if(n[s]=m,m!=s){for(var v=0;t>=v;v++)g=b[v][m],b[v][m]=b[v][s],b[v][s]=g;for(var v=s;a>v;v++)g=b[m][v],b[m][v]=b[s][v],b[s][v]=g}m=++s}else m++}for(var v=s;t>=v;v++)n[v]=1;do{m=0;for(var v=s;t>=v;v++){f=i=0;for(var u=s;t>=u;u++)u!=v&&(f+=Math.abs(b[u][v]),i+=Math.abs(b[v][u]));if(0!=f&&0!=i){for(h=i/p,g=1,j=f+i;h>f;)g*=p,f*=q;for(h=i*p;f>=h;)g/=p,f/=q;if(.95*j>(f+i)/g){h=1/g,n[v]*=g,m=1;for(var u=s;a>u;u++)b[v][u]*=h;for(var u=0;t>=u;u++)b[u][v]*=g}}}}while(m)}l=s,k=t;for(var v=l+1;k>v;v++){s=v,f=0;for(var u=v;k>=u;u++)Math.abs(b[u][v-1])>Math.abs(f)&&(f=b[u][v-1],s=u);if(o[v]=s,s!=v){for(var u=v-1;a>u;u++)i=b[s][u],b[s][u]=b[v][u],b[v][u]=i;for(var u=0;k>=u;u++)i=b[u][s],b[u][s]=b[u][v],b[u][v]=i}if(0!=f)for(var w=v+1;k>=w;w++)if(i=b[w][v-1],0!=i){i=b[w][v-1]=i/f;for(var u=v;a>u;u++)b[w][u]+=-(i*b[v][u]);for(var u=0;k>=u;u++)b[u][v]+=i*b[u][w]}}e.outEr=r,computeQR(a,b,l,k,d,c,e),r=e.outEr}function buildOutputHTML(a,b,c,d,e){if(b>0){for(var f=0;b>f;f++)e.outmsgstr=e.outmsgstr+c[f],0!=d[f]&&(e.outmsgstr=d[f]>0?e.outmsgstr+" + "+d[f]+"i":e.outmsgstr+" -  "+Math.abs(d[f])+"i"),e.outmsgstr=e.outmsgstr+"<br/>";99!=a&&-1!=a&&(e.outmsgstr=e.outmsgstr+"<br/> &nbsp; &nbsp; <b>Error Code</b>: "+a),e.outmsgstr=e.outmsgstr+"<br/>"}}function calc(a){if($hresults=$("#hresults"),$presults=$("#presults"),$matrix=$("#matrix"),!(1>a)){for(var b=new Array(a),c=new Array(a),d=new Array(a),e=0;a>e;e++)b[e]=new Array(a);var f=new Object;f.outmsgstr="";var g=new Object;g.outEr=0;for(var e=0;a>e;e++)for(var h=0;a>h;h++)b[e][h]=1/(e+h-1+2);if(20>a){for(var i="",e=0;a>e;e++){for(var h=0;a>h;h++)i=i+"\\tfrac{1}{"+(e+h-1+2)+"}",h!=a-1&&(i+="&");i+="\\\\"}var j="$ M = \\left( \\begin{matrix} "+i+"\\end{matrix} \\right)$";$matrix.html(j),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"matrix"])}else $matrix.html("");computeEigenSystem(a,b,d,c,g),buildOutputHTML(g.outEr,a,d,c,f),dataToSave=f.outmsgstr.replace(/<br\/>/g,"\n"),$hresults.html("The eigenvalues follow:"),$presults.html(f.outmsgstr),$presults.append("<a href='http://www.wolframalpha.com/input/?i="+a+"x"+a+"+Hilbert+matrix'>Verify with Wolfram Alpha</a>"),$presults.append(" · <a href='#' onclick='window.print()';'>Print</a>"),$presults.append(" · <a href='#' onclick='save()';'>Save</a>")}}function save(){var a=new Blob([dataToSave],{type:"text/plain;charset=utf-8"});saveAs(a,"eigenvalues.txt")}var dataToSave=new Object;$(document).ready(function(){$hresults=$("#hresults"),$presults=$("#presults"),$hresults.html("Enter matrix dimension and press enter."),$presults.html(""),$(".numeric").numeric(),$input=$("input"),$input.keydown(function(a){if(13==a.keyCode){a.preventDefault();var b=$input.val();calc(b)}}),$("#calcButton").button().click(function(){var a=$input.val();calc(a)})});